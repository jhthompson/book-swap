{% extends "core/base.html" %}

{% block main %}
<h1 class="center text-align:center color-primary">{{swap.proposed_by.username}} wants to swap with {{ swap.proposed_to.username }}</h1>

<div class="stack center">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2>{{ swap.proposed_by.username }}'s books</h2>
            <ul>
                {% for book in swap.offered_books.all %}
                    <li>{{ book.title }}</li>
                {% endfor %}
            </ul>
        </div>

        <i class="bi bi-arrow-left-right font-size:s1"></i>

        <div>
            <h2>{{ swap.proposed_to.username }}'s books</h2>
            <ul>
                {% for book in swap.requested_books.all %}
                    <li>{{ book.title }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <ol class="stack list-style:none padding:0 display:flex flex-direction:column align-items:flex-start">
        {% for entry in swap.get_timeline %}
            <div class="{% if entry.item.user == request.user %}margin-inline-end:s0{% else %}margin-inline-start:s0 align-self:flex-end{% endif %}">
                {% if entry.type == 'event' %}
                    <li class="box">{{ entry.item.user }} {{ entry.item.get_type_display|lower }} this swap</li>
                {% elif entry.type == 'message' %}
                    <li class="box">{{ entry.item.content }}</li>
                {% endif %}
                <small>{{ entry.item.created_at }}</small>
            </div>
        {% endfor %}
    </ol>

    {% if swap.status == 'PROPOSED' %}
    <div class="display:flex justify-content:flex-end gap:s0">
        {% if swap.proposed_by == request.user %}
            <a class="button" href="{% url 'cancel_swap' swap.id %}">Cancel</a>
        {% else %}
            <a class="button" href="{% url 'accept_swap' swap.id %}">Accept</a>
            <a class="button" href="{% url 'decline_swap' swap.id %}">Decline</a>
        {% endif %}
    </div>
    {% elif swap.status == 'CANCELLED' %}

    {% elif swap.status == 'ACCEPTED' %}

    {% elif swap.status == 'DECLINED' %}

    {% endif %}
</div>

{% endblock main %}
